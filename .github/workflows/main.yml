name: "Main Pipeline"

on:
  push:
    branches: ["main"]
    paths-ignore:
      - "**/*.md"
      - "docker-compose.yml"

jobs:
  build:
    name: "Build and publish Docker image"
    uses: ./.github/workflows/job_build.yml
    secrets: inherit

  terraform:
    name: "Provision infrastructure"
    uses: ./.github/workflows/job_terraform.yml
    needs: build
    with:
      frontend_image_tag: ${{ needs.build.outputs.frontend_image_tag }}
      backend_image_tag: ${{ needs.build.outputs.backend_image_tag }}
    secrets: inherit
